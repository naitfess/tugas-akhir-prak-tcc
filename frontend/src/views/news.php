<?php
ob_start();
?>
<main>         
    <!-- breadcrumb start -->
    <section class="breadcrumb bg_img ul_li" data-background="../../public/common/img/bg/breadcrumb_bg.jpg">
        <div class="container">
            <div class="breadcrumb__content text-center">
                <h2 class="breadcrumb__title">our news</h2>
                <p class="breadcrumb__desc">Latest Announcements and Updates</p>
            </div>
        </div>
    </section>
    <!-- breadcrumb end -->
    
    <!-- blog start -->
    <section class="blog_section pt-120 pb-120" data-bg-color="#F1F1E9">
        <div class="container">
            <div class="blog_onecol_carousel overflow-hidden">
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <div class="blog_post_block content_over_layout">
                            <div class="blog_post_image">
                                <a class="image_wrap" href="#">
                                    <img src="../../public/common/img/blog/hero-news.jpg" alt="Blog Post Image 1">
                                </a>
                            </div>
                            <div class="blog_post_content">
                                <div class="post_meta_wrap">
                                    <a class="post_category" href="#!">#News</a>
                                </div>
                                <h3 class="blog_post_title border-effect">
                                    <a>
                                        Pantengin terus halaman ini biar kamu nggak kudet soal info-info terbaru dan update seru lainnya!
                                    </a>
                                </h3>
                                <p class="mb-0">
                                    Baca yang penting, tahu yang seru, biar tetap update setiap waktu.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="blog_post_block content_over_layout">
                            <div class="blog_post_image">
                                <a class="image_wrap" href="#">
                                    <img src="../../public/common/img/blog/hero-news.jpg" alt="Blog Post Image 1">
                                </a>
                            </div>
                            <div class="blog_post_content">
                                <div class="post_meta_wrap">
                                    <a class="post_category" href="#!">#News</a>
                                </div>
                                <h3 class="blog_post_title border-effect">
                                    <a>
                                        Pantengin terus halaman ini biar kamu nggak kudet soal info-info terbaru dan update seru lainnya!
                                    </a>
                                </h3>
                                <p class="mb-0">
                                    Baca yang penting, tahu yang seru, biar tetap update setiap waktu.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="b1cc-swiper-button-prev" type="button" style="background-image: url('../../public/edubost/img/shape/shape_arrow_right.svg');">
                    <i class="fas fa-angle-double-left"></i>
                </button>
                <button class="b1cc-swiper-button-next" type="button" style="background-image: url('../../public/edubost/img/shape/shape_arrow_left.svg');">
                    <i class="fas fa-angle-double-right"></i>
                </button>
                <div class="b1cc-swiper-pagination p-0"></div>
            </div>
            <div class="section_space pb-0">
                <div class="row mt-none-30">
                    <div class="col-lg-8 mt-30" id="news-list">
                        <div class="blog_post_block image_left_layout">
                            <div class="blog_post_image">
                                <a class="image_wrap" href="blog-single.html">
                                    <img src="../../public/edubost/img/blog/blog_07.jpg" alt="Blog Post Image 1">
                                </a>
                            </div>
                            <div class="blog_post_content">
                                <div class="post_meta_wrap">
                                    <ul class="post_meta unordered_list">
                                        <li>
                                            <a href="#!">
                                                <i class="far fa-calendar"></i> 11 December 2024
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <h3 class="blog_post_title border-effect">
                                    <a href="blog-single.html">
                                        EduFord University Hosts International Conference on Climate Change..
                                    </a>
                                </h3>
                                <p>
                                    Embark on a journey into the dynamic  of IT solutions.
                                </p>
                                <div class="post_meta_wrap">
                                    <ul class="category_btns_group unordered_list">
                                        <li><a href="#!">#Study programs</a></li>
                                    </ul>
                                    <ul class="category_btns_group unordered_list">
                                        <li><a href="#!">#Study programs</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 mt-30">
                        <aside class="sidebar ps-xl-5">
                            <div class="search_form">
                                <h3 class="sidebar_widget_title">Search</h3>
                                <form class="form-group" autocomplete="off">
                                    <input class="form-control" type="search" name="search" placeholder="Search your keyword">
                                    <button type="submit">
                                        <img src="../../public/edubost/img/icon/icon_search.svg" alt="Search Icon">
                                    </button>
                                </form>
                            </div>
                            <!-- <div class="post_list_block">
                                <h3 class="sidebar_widget_title">Related Posts</h3>
                                <ul class="unordered_list_block">
                                    <li>
                                        <div class="post_image">
                                            <a href="blog-single.html"><img src="../../public/edubost/img/blog/blog_09.jpg" alt=""></a>
                                        </div>
                                        <div class="post_holder">
                                            <h3 class="post_title border-effect-2">
                                                <a href="blog-single.html">
                                                    EduFord University Opens New High-Tech Library..
                                                </a>
                                            </h3>
                                            <a class="post_date" href="#!">
                                                <i class="far fa-clock"></i> 11/12/2024
                                            </a>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="post_image">
                                            <a href="blog-single.html"><img src="../../public/edubost/img/blog/blog_10.jpg" alt=""></a>
                                        </div>
                                        <div class="post_holder">
                                            <h3 class="post_title border-effect-2">
                                                <a href="blog-single.html">
                                                    Universityâ€™s STEM Ranks Top 10 Nationwide..
                                                </a>
                                            </h3>
                                            <a class="post_date" href="#!">
                                                <i class="far fa-clock"></i> 11/12/2024
                                            </a>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="post_image">
                                            <a href="blog-single.html"><img src="../../public/edubost/img/blog/blog_11.jpg" alt=""></a>
                                        </div>
                                        <div class="post_holder">
                                            <h3 class="post_title border-effect-2">
                                                <a href="blog-single.html">
                                                    EduFord University Host Global Sustainability..
                                                </a>
                                            </h3>
                                            <a class="post_date" href="#!">
                                                <i class="far fa-clock"></i> 11/12/2024
                                            </a>
                                        </div>
                                    </li>
                                </ul>
                            </div> -->
                            <div class="post_category_wrap">
                                <h3 class="sidebar_widget_title">Categories</h3>
                                <ul class="post_category_list unordered_list_block" id="categories-list">
                                    <!-- categories -->
                                </ul>
                            </div>
                        </aside>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- blog end -->
    
</main>
<?php
$content = ob_get_clean();
ob_start();
?>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const beUrl = 'http://localhost:5000'; 
    const feUrl = 'http://localhost:8080/frontend/src/views';

    function renderNews(newsList) {
        const newsContainer = document.getElementById('news-list');
        if (!newsContainer) return;
        if (!Array.isArray(newsList) || newsList.length === 0) {
            newsContainer.innerHTML = `<div class="text-center text-muted">No news found</div>`;
            return;
        }
        newsContainer.innerHTML = newsList.map(news => `
            <div class="blog_post_block image_left_layout mb-4">
                <div class="blog_post_image">
                    <a class="image_wrap" href="${beUrl}/api/news/${news.id}">
                        <img src="${news.image}" alt="News Image">
                    </a>
                </div>
                <div class="blog_post_content">
                    <div class="post_meta_wrap">
                        <ul class="post_meta unordered_list">
                            <li>
                                <a href="#!">
                                    <i class="far fa-calendar"></i> 
                                    ${news.date ? new Date(news.date).toLocaleDateString('id-ID', { day: '2-digit', month: 'long', year: 'numeric' }) : '-'}
                                </a>
                            </li>
                        </ul>
                    </div>
                    <h3 class="blog_post_title border-effect">
                        <a href="${beUrl}/api/news/${news.id}">
                            ${news.title}
                        </a>
                    </h3>
                    <p>${news.content ? news.content.substring(0, 120).replace(/<[^>]+>/g, '') + '...' : ''}</p>
                    <div class="post_meta_wrap">
                        <ul class="category_btns_group unordered_list">
                            ${
                                news.categories && news.categories.length > 0
                                ? news.categories.map(cat => `<li><a href="#" data-category="${cat.id}">#${cat.name}</a></li>`).join('')
                                : ''
                            }
                        </ul>
                    </div>
                </div>
            </div>
        `).join('');
    }

    // Handler klik kategori (sidebar & list)
    document.addEventListener('click', function (e) {
        const a = e.target.closest('a[data-category]');
        if (a) {
            e.preventDefault();
            const catId = a.getAttribute('data-category');
            const urlParams = new URLSearchParams(window.location.search);
            urlParams.set('category', catId);
            urlParams.delete('search');
            window.history.replaceState({}, '', `${location.pathname}?${urlParams}`);

            fetch(`${beUrl}/api/news/category/${catId}`)
                .then(response => {
                    if (!response.ok) throw new Error('Failed to fetch news');
                    return response.json();
                })
                .then(renderNews)
                .catch(() => {
                    const newsContainer = document.getElementById('news-list');
                    if (newsContainer) newsContainer.innerHTML = `<div class="text-danger text-center">Failed to load news</div>`;
                });
        }
    });

    // Handler search
    const searchInput = document.querySelector('.search_form input[name="search"]');
    const searchForm = document.querySelector('.search_form .form-group');
    if (searchInput && searchForm) {
        searchForm.addEventListener('submit', function (e) {
            e.preventDefault();
            const searchValue = searchInput.value.trim();
            const urlParams = new URLSearchParams(window.location.search);
            urlParams.set('search', searchValue);
            urlParams.delete('category');
            window.history.replaceState({}, '', `${location.pathname}?${urlParams}`);
            fetch(`${beUrl}/api/news?search=${encodeURIComponent(searchValue)}`)
                .then(response => {
                    if (!response.ok) throw new Error('Failed to fetch news');
                    return response.json();
                })
                .then(renderNews)
                .catch(() => {
                    const newsContainer = document.getElementById('news-list');
                    if (newsContainer) newsContainer.innerHTML = `<div class="text-danger text-center">Failed to load news</div>`;
                });
        });
    }

    // Inisialisasi: tampilkan news sesuai query string
    const urlParams = new URLSearchParams(window.location.search);
    const categoryParam = urlParams.get('category');
    const searchParam = urlParams.get('search');

    if (categoryParam) {
        fetch(`${beUrl}/api/news/category/${categoryParam}`)
            .then(response => {
                if (!response.ok) throw new Error('Failed to fetch news');
                return response.json();
            })
            .then(renderNews)
            .catch(() => {
                const newsContainer = document.getElementById('news-list');
                if (newsContainer) newsContainer.innerHTML = `<div class="text-danger text-center">Failed to load news</div>`;
            });
    } else if (searchParam) {
        fetch(`${beUrl}/api/news?search=${encodeURIComponent(searchParam)}`)
            .then(response => {
                if (!response.ok) throw new Error('Failed to fetch news');
                return response.json();
            })
            .then(renderNews)
            .catch(() => {
                const newsContainer = document.getElementById('news-list');
                if (newsContainer) newsContainer.innerHTML = `<div class="text-danger text-center">Failed to load news</div>`;
            });
    } else {
        fetch(`${beUrl}/api/news`)
            .then(response => response.json())
            .then(renderNews);
    }

    // Load categories (sidebar)
    fetch(`${beUrl}/api/categories`)
        .then(response => {
            if (!response.ok) throw new Error('Failed to fetch categories');
            return response.json();
        })
        .then(categories => {
            const ul = document.getElementById('categories-list');
            if (!ul) return;
            if (!Array.isArray(categories) || categories.length === 0) {
                ul.innerHTML = `<li><span class="text-muted">No categories found</span></li>`;
                return;
            }
            ul.innerHTML = categories.map(cat => `
                <li>
                    <a href="#" data-category="${cat.id}">
                        <i class="far fa-arrow-right"></i>
                        <span>${cat.name}</span>
                    </a>
                </li>
            `).join('');
        })
        .catch(() => {
            const ul = document.getElementById('categories-list');
            if (ul) ul.innerHTML = `<li><span class="text-danger">Failed to load categories</span></li>`;
        });
});
</script>
<?php
$js = ob_get_clean();
include __DIR__ . '/layout/layout-guest.php';